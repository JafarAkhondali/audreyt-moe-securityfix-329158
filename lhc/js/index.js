// Generated by LiveScript 1.2.0
(function(){
  var origin, buffer, $input, $output, CharComp, CompChar, OrigChars, msgBeforeData, uniq, msgAfterData, split$ = ''.split, join$ = [].join;
  Array.prototype.powerset = String.prototype.powerset = function(){
    var xs, x, p;
    if (this.length <= 1) {
      return this;
    }
    xs = Array.prototype.slice.call(this);
    x = Array.prototype.pop.call(xs);
    p = xs.powerset();
    return p.concat(p.map(function(it){
      return it.concat([x]);
    }));
  };
  String.prototype.permutate = function(){
    var ret, xs, x, p, i$, len$, set, j$, to$, i, before, after;
    if (this.length === 1) {
      return this;
    }
    ret = [];
    xs = this.substr(1);
    x = this[0];
    p = xs.permutate();
    for (i$ = 0, len$ = p.length; i$ < len$; ++i$) {
      set = p[i$];
      for (j$ = 0, to$ = set.length; j$ <= to$; ++j$) {
        i = j$;
        before = set.substring(0, i);
        after = set.substring(i);
        ret.push(before + x + after);
      }
    }
    return ret;
  };
  origin = "http://127.0.0.1:8888/";
  buffer = [];
  $input = $('#input');
  $output = $('#output');
  buffer = [];
  msgBeforeData = function(arg$){
    var data;
    data = arg$.data;
    return buffer.push(data);
  };
  window.uniq = uniq = function(it){
    var seen, i$, ref$, len$, w;
    seen = {};
    for (i$ = 0, len$ = (ref$ = split$.call(it, '')).length; i$ < len$; ++i$) {
      w = ref$[i$];
      seen[w] = true;
    }
    return join$.call(Object.keys(seen).sort(), '');
  };
  msgAfterData = function(arg$){
    var data, comps, getComps, seen, i$, len$, ch, scanned, queue, callback, count, ref$, taken, rest, c, head, keys, char;
    data = arg$.data;
    data = uniq($input.val() + data);
    $input.val(data);
    comps = [];
    getComps = function(it){
      var out, i$, len$, char, comps;
      out = "";
      if (it.length <= 0) {
        return out;
      }
      for (i$ = 0, len$ = it.length; i$ < len$; ++i$) {
        char = it[i$];
        comps = CharComp[char];
        if (comps) {
          out += comps;
        }
      }
      return it + getComps(out);
    };
    comps = uniq(getComps(data));
    seen = {};
    for (i$ = 0, len$ = comps.length; i$ < len$; ++i$) {
      ch = comps[i$];
      if (in$(ch, OrigChars)) {
        seen[ch] = true;
      }
    }
    scanned = {
      '': true
    };
    queue = [];
    callback = null;
    queue = [['', comps]];
    count = 0;
    while (queue.length) {
      if (count++ > 1000) {
        break;
      }
      ref$ = queue.shift(), taken = ref$[0], rest = ref$[1];
      if (!scanned[taken]) {
        scanned[taken] = true;
        c = CompChar[taken];
        if (c && in$(c, OrigChars)) {
          seen[c] = true;
        }
      }
      if (rest.length === 0) {
        break;
      }
      head = rest[0];
      rest = rest.substr(1);
      queue.push([taken, rest]);
      queue.push([taken + head, rest]);
    }
    keys = Object.keys(seen);
    $output.empty();
    for (i$ = 0, len$ = keys.length; i$ < len$; ++i$) {
      char = keys[i$];
      $output.append($('<li/>').append($('<a/>', {
        href: '#'
      }).text(char)).click(fn$));
    }
    return JSON.stringify(keys, void 8, 2);
    function fn$(){
      return window.output($(this).text());
    }
  };
  window.id = 'lhc';
  window.reset = function(){
    return $input.val("");
  };
  window.input = function(it){
    return msgBeforeData({
      data: it
    });
  };
  window.addEventListener('message', msgBeforeData);
  window.output = function(it){
    if (window.muted) {
      return;
    }
    return window.top.postMessage(it, origin);
  };
  $.get('./data/char_comp_simple.json', function(d){
    CharComp = d;
    return $.get('./data/comp_char_sorted.json', function(d){
      CompChar = d;
      return $.get('./data/orig-chars.json', function(d){
        var i$, ref$, len$, data;
        OrigChars = d;
        window.input = function(it){
          return msgAfterData({
            data: it
          });
        };
        window.removeEventListener('message', msgBeforeData);
        for (i$ = 0, len$ = (ref$ = buffer).length; i$ < len$; ++i$) {
          data = ref$[i$];
          msgAfterData({
            data: data
          });
        }
        return window.addEventListener('message', msgAfterData);
      });
    });
  });
  function in$(x, xs){
    var i = -1, l = xs.length >>> 0;
    while (++i < l) if (x === xs[i]) return true;
    return false;
  }
}).call(this);
