<!doctype html>
<!--[if lt IE 7]> <html lang="zh-tw" class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html lang="zh-tw" class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html lang="zh-tw" class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="zh-tw"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>萌典字宙反應爐</title>
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" media="screen" href="./stylesheets/hub.css">
<link rel="stylesheet" media="screen" href="./styles.css">
<script src="js/jquery.js"></script>
<script src="main.js"></script>
</head>
<body>
    <div class="twinkling"></div>
    <div class="content-wrapper">
        <div class="main-control">
            <span class="testpoint">.</span>
            <a href="#" class="gogo" style="visibility: hidden">gogo</a>
            <a href="#" class="main-btn">主選單</a>
            <div class="tube project-users"><a href="#" class="tube-status open"><i class="icon-circle-blank"></i></a></div>
            <div class="tube project-tmuse"><a href="#" class="tube-status open"><i class="icon-circle-blank"></i></a></div>
            <div class="tube project-dict"><a href="#" class="tube-status open"><i class="icon-circle-blank"></i></a></div>
            <div class="tube project-ball"><a href="#" class="tube-status open"><i class="icon-circle-blank"></i></a></div>
            <div class="tube project-lhc"><a href="#" class="tube-status open"><i class="icon-circle-blank"></i></a></div>
            <div class="tube project-map"><a href="#" class="tube-status open"><i class="icon-circle-blank"></i></a></div>
        </div>
        <div class="iframe-wrapper v-type project-users">
            <div class="iframe-header">
                <div class="controls">
                    <a href="#" class="zoom"><i class="icon-zoom-in"></i></a>
                </div>
                <label>部件對撞</label>
                <div class="input">
                    <input type="text" class="input-words" />
                    <button>⏎</button>
                </div>
            </div>
            <div class="iframe">
            <iframe src="./lhc/?"></iframe>
            </div>
        </div>
        <div class="iframe-wrapper w-type project-tmuse">
            <div class="iframe-header">
                <div class="controls">
                    <a href="#" class="zoom"><i class="icon-zoom-in"></i></a>
                </div>
                <label>聯想叢集</label>
                <div class="input">
                    <input type="text" class="input-words" />
                    <button>⏎</button>
                </div>
            </div>
            <div class="iframe">
            <iframe src="./tmuse/?"></iframe>
            </div>
        </div>
        <div class="iframe-wrapper v-type project-dict">
            <div class="iframe-header">
                <div class="controls">
                    <a href="#" class="zoom"><i class="icon-zoom-in"></i></a>
                </div>
                <label>兩岸詞典</label>
                <div class="input">
                    <input type="text" class="input-words" />
                    <button>⏎</button>
                </div>
            </div>
            <div class="iframe">
            <iframe src="./dict/?"></iframe>
            </div>
        </div>
        <div class="iframe-wrapper n-type project-ball">
            <div class="iframe-header">
                <div class="controls">
                    <a href="#" class="zoom"><i class="icon-zoom-in"></i></a>
                </div>
                <label>形音相似</label>
                <div class="input">
                    <input type="text" class="input-words" />
                    <button>⏎</button>
                </div>
            </div>
            <div class="iframe">
            <iframe src="./ball/?"></iframe>
            </div>
        </div>
        <div class="iframe-wrapper w-type project-lhc">
            <div class="iframe-header">
                <div class="controls">
                    <a href="#" class="zoom"><i class="icon-zoom-in"></i></a>
                </div>
                <label>誰在線上</label>
                <div class="input">
                    <input type="text" class="input-words" />
                    <button>⏎</button>
                </div>
            </div>
            <div class="iframe">
            <iframe src="./users/?"></iframe>
            </div>
        </div>
        <div class="iframe-wrapper n-type project-map">
            <div class="iframe-header">
                <div class="controls">
                    <a href="#" class="zoom"><i class="icon-zoom-in"></i></a>
                </div>
                <label>字形景點</label>
                <div class="input">
                    <input type="text" class="input-words" />
                    <button>⏎</button>
                </div>
            </div>
            <div class="iframe">
            <iframe src="./map/?"></iframe>
            </div>
        </div>
    </div>
    <div class="lightbox">
        <a href="#" class="lightbox-close"><i class="icon-remove"></i></a>
        <div class="big-iframe">
            <iframe src="./welcome-static/welcome.html"></iframe>
        </div>
        <div class="nav">
        <!--
            <ul>
                <li><a href="#">匯出記錄</a></li>
                <li><a href="#">關於</a></li>
                <li class="share">
                    告訴朋友：
                    <a href="#"><i class="icon-facebook-sign"></i></a>
                    <a href="#"><i class="icon-google-plus-sign"></i></a>
                    <a href="#"><i class="icon-twitter-sign"></i></a>
                </li>
            </ul>
            -->
        </div>
    </div>

<script src="javascripts/jquery-1.10.2.min.js"></script>
<script>
$(function(){
    // get window width & height
    var windowWidth = $(window).width();
    var windowHeight = $(window).height();

    // set content-wrapper height
    var contentWidth, contentHeight;
    if (windowHeight/windowWidth <= 9/16*1.2) {
        contentWidth = windowHeight / 9 * 16;
        contentHeight = windowHeight;
    }
    else {
        contentWidth = windowWidth;
        contentHeight = windowWidth / 4 * 3;
    }
    $(".content-wrapper").css({width: contentWidth, height: contentHeight, "background-size": '"'+contentWidth*0.8+'px '+contentWidth*0.48+'px"'});

    // calculate main-control position
    $(".main-control .main-btn").css({"z-index": 10, top: contentHeight*0.5 - 42, left: contentWidth*0.5-42});

    // calculate block size
    var nBlockWidth, nBlockHeight, wBlockWidth, vBlockHeight;
    nBlockWidth = contentWidth * 0.28;
    nBlockHeight = contentHeight * 0.467;
    wBlockHeight = contentHeight * 0.32;
    wBlockWidth = contentWidth* 0.34;
    vBlockHeight = contentHeight * 0.467;

    $(".iframe-wrapper.n-type").css({width: nBlockWidth, height: nBlockHeight});
    $(".iframe-wrapper.w-type").css({width: wBlockWidth, height: wBlockHeight});
    $(".iframe-wrapper.v-type").css({width: nBlockWidth, height: vBlockHeight});
    $(".iframe-wrapper .iframe").css({width: nBlockWidth-16, height: nBlockHeight-46});
    $(".iframe-wrapper.v-type .iframe").css({height: vBlockHeight-46});
    $(".iframe-wrapper.w-type .iframe").css({height: wBlockHeight-46, width: wBlockWidth-16});

    // calculate block position. project-users, project-tmuse, project-dict, project-ball, project-lhc, project-map
    $(".iframe-wrapper.project-tmuse").css({top: contentHeight*0.01});
    $(".iframe-wrapper.v-type").css({top:contentHeight*0.02});
    $(".iframe-wrapper.project-ball, .iframe-wrapper.project-map").css({top:contentHeight*0.51});
    $(".iframe-wrapper.project-lhc").css({top: contentHeight*0.99-wBlockHeight});
    $(".iframe-wrapper.w-type").css({left:(contentWidth-wBlockWidth)/2});
    $(".iframe-wrapper.project-users, .iframe-wrapper.project-ball").css({left:"2%"});
    $(".iframe-wrapper.project-dict, .iframe-wrapper.project-map").css({left:contentWidth*0.98-nBlockWidth});

    // tube-status position 
    var centerPointX = contentWidth/2;
    var centerPointY = contentHeight/2;
    $(".tube.project-users .tube-status, .tube.project-dict .tube-status").css({top: centerPointY-41});
    $(".tube.project-ball .tube-status, .tube.project-map .tube-status").css({top: centerPointY+6});
    $(".tube.project-users .tube-status, .tube.project-ball .tube-status").css({left: centerPointX-94});
    $(".tube.project-dict .tube-status, .tube.project-map .tube-status").css({left: centerPointX+58});
    $(".tube.project-tmuse .tube-status, .tube.project-lhc .tube-status").css({left: centerPointX-18});
    $(".tube.project-tmuse .tube-status").css({top: centerPointY-96});
    $(".tube.project-lhc .tube-status").css({top: centerPointY+60});

    // tube-status toggle
    $(".tube-status").on("click", function() {
        $(this).toggleClass("open").toggleClass("close");
        $(this).find("i").toggleClass("icon-circle-blank").toggleClass("icon-ban-circle");
    });

    // input / output words
    var rCenterPointX = centerPointX - 1;
    var rCenterPointY = centerPointY - 10;
    var pUserWordPosition = {"top": rCenterPointY-contentWidth*0.3*0.31, "left": rCenterPointX-contentWidth*0.3};
    var pTmuseWordPosition = {"top": rCenterPointY-contentHeight*0.3, "left": rCenterPointX};
    var pDictWordPosition = {"top": rCenterPointY-contentWidth*0.3*0.31, "left": rCenterPointX+contentWidth*0.3};
    var pBallWordPosition = {"top": rCenterPointY+contentWidth*0.3*0.31, "left": rCenterPointX-contentWidth*0.3};
    var pLhcWordPosition = {"top": rCenterPointY+contentHeight*0.3, "left": rCenterPointX};
    var pMapWordPosition = {"top": rCenterPointY+contentWidth*0.3*0.31, "left": rCenterPointX+contentWidth*0.3};

    // dirty code...
    var pUserWord = function(word, rev) {
        $(".tube.project-users").append('<span class="moving-word output">'+word+'</span>');
        var wWidth = $(".tube.project-users .moving-word").width();
        var wHeight = $(".tube.project-users .moving-word").height();
        var startPointX = pUserWordPosition.left - (wWidth+30)/2;
        var startPointY = pUserWordPosition.top - (wHeight+26)/2;
        var X = rCenterPointX - (wWidth+30)/2;
        var Y = rCenterPointY - (wWidth+26)/2;
        var endPointX = X, endPointY = Y;
        if (!rev) { endPointX = startPointX; startPointX = X; endPointY = startPointY; startPointY = Y; }
        
        $(".tube.project-users .moving-word").css({top: startPointY, left: startPointX});
        $(".tube.project-users .moving-word").animate(
            {top: endPointY, left: endPointX}, {
            duration: rev ? 1000 : 1500,
            complete: function() {
                $(".tube.project-users .moving-word").fadeOut('slow', function(){
                    $(this).remove();
                });
            }
        });
    };
    var pTmuseWord = function(word, rev) {
        $(".tube.project-tmuse").append('<span class="moving-word output">'+word+'</span>');
        var wWidth = $(".tube.project-tmuse .moving-word").width();
        var wHeight = $(".tube.project-tmuse .moving-word").height();
        var startPointX = pTmuseWordPosition.left - (wWidth+30)/2;
        var startPointY = pTmuseWordPosition.top - (wHeight+26)/2;
        var X = rCenterPointX - (wWidth+30)/2;
        var Y = rCenterPointY - (wWidth+26)/2;
        var endPointX = X, endPointY = Y;
        if (!rev) { endPointX = startPointX; startPointX = X; endPointY = startPointY; startPointY = Y; }
        $(".tube.project-tmuse .moving-word").css({top: startPointY, left: startPointX});
        $(".tube.project-tmuse .moving-word").animate(
            {top: endPointY, left: endPointX}, {
            duration: rev ? 1000 : 1500,
            complete: function() {
                $(".tube.project-tmuse .moving-word").fadeOut('slow', function(){
                    $(this).remove();
                });
            }
        });
    };
    var pDictWord = function(word, rev) {
        $(".tube.project-dict").append('<span class="moving-word output">'+word+'</span>');
        var wWidth = $(".tube.project-dict .moving-word").width();
        var wHeight = $(".tube.project-dict .moving-word").height();
        var startPointX = pDictWordPosition.left - (wWidth+30)/2;
        var startPointY = pDictWordPosition.top - (wHeight+26)/2;
        var X = rCenterPointX - (wWidth+30)/2;
        var Y = rCenterPointY - (wWidth+26)/2;
        var endPointX = X, endPointY = Y;
        if (!rev) { endPointX = startPointX; startPointX = X; endPointY = startPointY; startPointY = Y; }
        $(".tube.project-dict .moving-word").css({top: startPointY, left: startPointX});
        $(".tube.project-dict .moving-word").animate(
            {top: endPointY, left: endPointX}, {
            duration: rev ? 1000 : 1500,
            complete: function() {
                $(".tube.project-dict .moving-word").fadeOut('slow', function(){
                    $(this).remove();
                });
            }
        });
    };
    var pBallWord = function(word, rev) {
        $(".tube.project-ball").append('<span class="moving-word output">'+word+'</span>');
        var wWidth = $(".tube.project-ball .moving-word").width();
        var wHeight = $(".tube.project-ball .moving-word").height();
        var startPointX = pBallWordPosition.left - (wWidth+30)/2;
        var startPointY = pBallWordPosition.top - (wHeight+26)/2;
        var X = rCenterPointX - (wWidth+30)/2;
        var Y = rCenterPointY - (wWidth+26)/2;
        var endPointX = X, endPointY = Y;
        if (!rev) { endPointX = startPointX; startPointX = X; endPointY = startPointY; startPointY = Y; }
        $(".tube.project-ball .moving-word").css({top: startPointY, left: startPointX});
        $(".tube.project-ball .moving-word").animate(
            {top: endPointY, left: endPointX}, {
            duration: rev ? 1000 : 1500,
            complete: function() {
                $(".tube.project-ball .moving-word").fadeOut('slow', function(){
                    $(this).remove();
                });
            }
        });
    };
    var pLhcWord = function(word, rev) {
        $(".tube.project-lhc").append('<span class="moving-word output">'+word+'</span>');
        var wWidth = $(".tube.project-lhc .moving-word").width();
        var wHeight = $(".tube.project-lhc .moving-word").height();
        var startPointX = pLhcWordPosition.left - (wWidth+30)/2;
        var startPointY = pLhcWordPosition.top - (wHeight+26)/2;
        var X = rCenterPointX - (wWidth+30)/2;
        var Y = rCenterPointY - (wWidth+26)/2;
        var endPointX = X, endPointY = Y;
        if (!rev) { endPointX = startPointX; startPointX = X; endPointY = startPointY; startPointY = Y; }
        $(".tube.project-lhc .moving-word").css({top: startPointY, left: startPointX});
        $(".tube.project-lhc .moving-word").animate(
            {top: endPointY, left: endPointX}, {
            duration: rev ? 1000 : 1500,
            complete: function() {
                $(".tube.project-lhc .moving-word").fadeOut('slow', function(){
                    $(this).remove();
                });
            }
        });
    };
    var pMapWord = function(word, rev) {
        $(".tube.project-map").append('<span class="moving-word output">'+word+'</span>');
        var wWidth = $(".tube.project-map .moving-word").width();
        var wHeight = $(".tube.project-map .moving-word").height();
        var startPointX = pMapWordPosition.left - (wWidth+30)/2;
        var startPointY = pMapWordPosition.top - (wHeight+26)/2;
        var X = rCenterPointX - (wWidth+30)/2;
        var Y = rCenterPointY - (wWidth+26)/2;
        var endPointX = X, endPointY = Y;
        if (!rev) { endPointX = startPointX; startPointX = X; endPointY = startPointY; startPointY = Y; }
        $(".tube.project-map .moving-word").css({top: startPointY, left: startPointX});
        $(".tube.project-map .moving-word").animate(
            {top: endPointY, left: endPointX}, {
            duration: rev ? 1000 : 1500,
            complete: function() {
                $(".tube.project-map .moving-word").fadeOut('slow', function(){
                    $(this).remove();
                });
            }
        });
    };
    //$(".testpoint").css(pTmuseWordPosition);

    $(".tube.project-users .moving-word").css(pLhcWordPosition);
    window.pushText = function(t, origin) {
        if ($(".project-users > .tube-status").hasClass('open'))
            pUserWord(t, origin == 'users');
        if ($(".project-tmuse > .tube-status").hasClass('open'))
            pTmuseWord(t, origin == 'tmuse');
        if ($(".project-dict > .tube-status").hasClass('open'))
            pDictWord(t, origin == 'dict');
        if ($(".project-ball > .tube-status").hasClass('open'))
            pBallWord(t, origin == 'ball');
        if ($(".project-lhc > .tube-status").hasClass('open'))
            pLhcWord(t, origin == 'lhc');
        if ($(".project-map > .tube-status").hasClass('open'))
            pMapWord(t, origin == 'map');
    };
    $(".gogo").on("click", function(e) {
        e.preventDefault();
        pUserWord("中文");
        pTmuseWord("中文");
        pDictWord("中文");
        pBallWord("中文");
        pLhcWord("中文");
        pMapWord("中文");
    });


    // zoom in & zoom out
    var originWidth, originHeight, originTop, originLeft;
    $("a.zoom").on("click", function(e) {
        e.preventDefault();
        var thisBlock = $(this).parents(".iframe-wrapper");
        var thisIframe = $(this).parents(".iframe-wrapper").find(".iframe");
        if ($(this).find("i").hasClass("icon-zoom-in")) {
            originWidth = thisBlock.width();
            originHeight = thisBlock.height();
            originTop = thisBlock.css("top");
            originLeft = thisBlock.css("left");
            thisBlock.css({"z-index": 9999, position: "fixed"}).css({width: windowWidth*0.98, height: windowHeight*0.98, top: "1%", left: "1%"});
            thisIframe.css({width: windowWidth*0.98-16, height: windowHeight*0.98-46});
            setTimeout(function(){
                thisBlock.siblings(".iframe-wrapper").find(".iframe").hide();
            }, 1000);
            $(this).find("i").removeClass("icon-zoom-in").addClass("icon-zoom-out");
        }
        else {
            thisBlock.siblings(".iframe-wrapper").find(".iframe").show();
            thisBlock.css({width: originWidth, height: originHeight, top: originTop, left: originLeft});
            thisIframe.css({width: originWidth-16, height: originHeight-46});
            thisBlock.css({"z-index": 5, position: "absolute"});
            
            $(this).find("i").removeClass("icon-zoom-out").addClass("icon-zoom-in");
        }
    });

    //lightbox
    $(".lightbox").hide();
    $(".main-btn").on("click", function() {
        $(".lightbox").fadeIn();
    });
    $(".lightbox .lightbox-close").on("click", function() {
        $(".lightbox").fadeOut();
    });

    setTimeout(function(){
        $('.content-wrapper').show();
    }, 1);
});
</script>
</body>
</html>
